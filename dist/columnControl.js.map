{"version":3,"sources":["columnControl.ts"],"names":[],"mappings":"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","file":"columnControl.js","sourcesContent":["import Editor, { IDtRequest } from './editor';\nimport { Knex } from 'knex';\n\nexport default class ColumnControl {\n\tpublic static ssp(editor: Editor, query: Knex.QueryBuilder<any, any>, http: IDtRequest) {\n\t\tfor (let i = 0; i < http.columns.length; i++) {\n\t\t\tlet column = http['columns'][i];\n\n\t\t\tif (column.columnControl) {\n\t\t\t\tlet field = editor.field(column['data']);\n\n\t\t\t\t// `<input>` based searches\n\t\t\t\tif (column.columnControl.search) {\n\t\t\t\t\tlet search = column.columnControl.search;\n\t\t\t\t\tlet value = search.value;\n\t\t\t\t\tlet logic = search.logic;\n\t\t\t\t\tlet type = search.type;\n\n\t\t\t\t\tif (type === 'num') {\n\t\t\t\t\t\tColumnControl._sspNumber(query, field, value, logic);\n\t\t\t\t\t}\n\t\t\t\t\telse if (type === 'date') {\n\t\t\t\t\t\tColumnControl._sspDate(query, field, value, logic, search.mask);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tColumnControl._sspText(query, field, value, logic);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// SearchList\n\t\t\t\tif (column.columnControl.list) {\n\t\t\t\t\tlet list = column.columnControl.list;\n\n\t\t\t\t\tquery.whereIn(field.dbField(), list);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Add conditions to a query for a ColumnControl date search.\n\t *\n\t * @param query Query to add the conditions to\n\t * @param field Field for the column in question\n\t * @param value Search term\n\t * @param logic Search logic\n\t * @param mask Mask value\n\t * @returns void\n\t */\n\tprivate static _sspDate(query, field, value, logic, mask) {\n\t\tlet dbField = field.dbField();\n\t\tlet search = '(?)';\n\n\t\t// Only support date and time masks. This departs from the client side which allows\n\t\t// any component in the date/time to be masked out.\n\t\tif (mask === 'YYYY-MM-DD') {\n\t\t\tdbField = 'DATE(' + dbField + ')';\n\t\t\tsearch = 'DATE(?)';\n\t\t}\n\t\telse if (mask === 'hh:mm:ss') {\n\t\t\tdbField = 'TIME(' + dbField + ')';\n\t\t\tsearch = 'TIME(?)';\n\t\t}\n\n\t\tif (logic === 'empty') {\n\t\t\tquery.whereNull(field.dbField());\n\t\t}\n\t\telse if (logic === 'notEmpty') {\n\t\t\tquery.whereNotNull(field.dbField());\n\t\t}\n\t\telse if (value === '') {\n\t\t\t// Empty search value means no search for the other logic operators\n\t\t\treturn;\n\t\t}\n\t\telse if (logic === 'equal') {\n\t\t\tquery.whereRaw(dbField + ' = ' + search, [value]);\n\t\t}\n\t\telse if (logic === 'notEqual') {\n\t\t\tquery.whereRaw(dbField + ' != ' + search, [value]);\n\t\t}\n\t\telse if (logic === 'greater') {\n\t\t\tquery.whereRaw(dbField + ' > ' + search, [value]);\n\t\t}\n\t\telse if (logic === 'less') {\n\t\t\tquery.whereRaw(dbField + ' < ' + search, [value]);\n\t\t}\n\t}\n\n\t/**\n\t * Add conditions to a query for a ColumnControl number search.\n\t *\n\t * @param query Query to add the conditions to\n\t * @param field Field for the column in question\n\t * @param value Search term\n\t * @param logic Search logic\n\t * @returns void\n\t */\n\tprivate static _sspNumber(query, field, value, logic) {\n\t\tif (logic === 'empty') {\n\t\t\tquery.where((q) => {\n\t\t\t\tq.whereNull(field.dbField());\n\t\t\t\tq.orWhere(field.dbField(), '=', '');\n\t\t\t});\n\t\t}\n\t\telse if (logic === 'notEmpty') {\n\t\t\tquery.where((q) => {\n\t\t\t\tq.whereNotNull(field.dbField());\n\t\t\t\tq.where(field.dbField(), '!=', '');\n\t\t\t});\n\t\t}\n\t\telse if (value === '') {\n\t\t\t// Empty search value means no search for the other logic operators\n\t\t\treturn;\n\t\t}\n\t\telse if (logic === 'equal') {\n\t\t\tquery.where(field.dbField(), '=', value);\n\t\t}\n\t\telse if (logic === 'notEqual') {\n\t\t\tquery.where(field.dbField(), '!=', value);\n\t\t}\n\t\telse if (logic === 'greater') {\n\t\t\tquery.where(field.dbField(), '>', value);\n\t\t}\n\t\telse if (logic === 'greaterOrEqual') {\n\t\t\tquery.where(field.dbField(), '>=', value);\n\t\t}\n\t\telse if (logic === 'less') {\n\t\t\tquery.where(field.dbField(), '<', value);\n\t\t}\n\t\telse if (logic === 'lessOrEqual') {\n\t\t\tquery.where(field.dbField(), '<=', value);\n\t\t}\n\t}\n\n\t/**\n\t * Add conditions to a query for a ColumnControl test search.\n\t *\n\t * @param query Query to add the conditions to\n\t * @param field Field for the column in question\n\t * @param value Search term\n\t * @param logic Search logic\n\t * @returns void\n\t */\n\tprivate static _sspText(query, field, value, logic) {\n\t\tif (logic === 'empty') {\n\t\t\tquery.where((q) => {\n\t\t\t\tq.whereNull(field.dbField());\n\t\t\t\tq.orWhere(field.dbField(), '=', '');\n\t\t\t});\n\t\t}\n\t\telse if (logic === 'notEmpty') {\n\t\t\tquery.where((q) => {\n\t\t\t\tq.whereNotNull(field.dbField());\n\t\t\t\tq.where(field.dbField(), '!=', '');\n\t\t\t});\n\t\t}\n\t\telse if (value === '') {\n\t\t\t// Empty search value means no search for the other logic operators\n\t\t\treturn;\n\t\t}\n\t\telse if (logic === 'equal') {\n\t\t\tquery.where(field.dbField(), '=', value);\n\t\t}\n\t\telse if (logic === 'notEqual') {\n\t\t\tquery.where(field.dbField(), '!=', value);\n\t\t}\n\t\telse if (logic === 'contains') {\n\t\t\tquery.where(field.dbField(), 'like', '%' + value + '%');\n\t\t}\n\t\telse if (logic === 'notContains') {\n\t\t\tquery.where(field.dbField(), 'not like', '%' + value + '%');\n\t\t}\n\t\telse if (logic === 'starts') {\n\t\t\tquery.where(field.dbField(), 'like', value + '%');\n\t\t}\n\t\telse if (logic === 'ends') {\n\t\t\tquery.where(field.dbField(), 'like', '%' + value);\n\t\t}\n\t}\n}\n"]}