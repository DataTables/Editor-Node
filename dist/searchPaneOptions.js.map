{"version":3,"sources":["searchPaneOptions.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKA,qCAAmC;AAEnC,SAAS,SAAS,CAAC,CAAC;IACnB,OAAO,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,IAAI,QAAQ,CAAC,CAAC,CAAC,CAAC;AAC7C,CAAC;AASD;;;;;;;;;;;GAWG;AACH;IAAA;QAIS,cAAS,GAAgB,EAAE,CAAC;IAwZrC,CAAC;IAlYO,iCAAK,GAAZ,UAAa,KAAgB;QAC5B,IAAI,KAAK,KAAK,SAAS,EAAE;YACxB,OAAO,IAAI,CAAC,MAAM,CAAC;SACnB;QAED,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC;YACnC,KAAK,CAAC,CAAC;YACP,CAAC,KAAK,CAAC,CAAC;QAET,OAAO,IAAI,CAAC;IACb,CAAC;IAiBM,iCAAK,GAAZ,UAAa,KAAc;QAC1B,IAAI,KAAK,KAAK,SAAS,EAAE;YACxB,OAAO,IAAI,CAAC,MAAM,CAAC;SACnB;QAED,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,OAAO,IAAI,CAAC;IACb,CAAC;IAiBM,kCAAM,GAAb,UAAc,EAAc;QAC3B,IAAI,EAAE,KAAK,SAAS,EAAE;YACrB,OAAO,IAAI,CAAC,SAAS,CAAC;SACtB;QAED,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;QACpB,OAAO,IAAI,CAAC;IACb,CAAC;IAeM,iCAAK,GAAZ,UAAa,KAAc;QAC1B,IAAI,KAAK,KAAK,SAAS,EAAE;YACxB,OAAO,IAAI,CAAC,MAAM,CAAC;SACnB;QAED,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,OAAO,IAAI,CAAC;IACb,CAAC;IAgBM,iCAAK,GAAZ,UAAa,KAAc;QAC1B,IAAI,KAAK,KAAK,SAAS,EAAE;YACxB,OAAO,IAAI,CAAC,MAAM,CAAC;SACnB;QAED,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,OAAO,IAAI,CAAC;IACb,CAAC;IAgBM,iCAAK,GAAZ,UAAa,KAAW;QACvB,IAAI,KAAK,KAAK,SAAS,EAAE;YACxB,OAAO,IAAI,CAAC,MAAM,CAAC;SACnB;QAED,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,OAAO,IAAI,CAAC;IACb,CAAC;IAED;;;;;;;;OAQG;IACI,oCAAQ,GAAf,UAAgB,KAAa,EAAE,MAAyB,EAAE,QAAgB,EAAE,MAAc;QACzF,IAAI,OAAO,MAAM,KAAK,UAAU,EAAE;YACjC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;gBACnB,MAAM,EAAE,EAAE;gBACV,MAAM,EAAE,EAAE;gBACV,EAAE,EAAE,MAAM;gBACV,QAAQ,EAAE,EAAE;gBACZ,KAAK,OAAA;aACL,CAAC,CAAC;SACH;aACI;YACJ,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;gBACnB,MAAM,QAAA;gBACN,MAAM,QAAA;gBACN,QAAQ,UAAA;gBACR,KAAK,OAAA;aACL,CAAC,CAAC;SACH;QAED,OAAO,IAAI,CAAC;IACb,CAAC;IAED;;OAEG;IAEH;;;;;;;OAOG;IACU,gCAAI,GAAjB,UACC,KAAY,EAAE,MAAc,EAAE,IAAS,EAAE,QAAa,EAAE,UAAe;;;;;;wBAEnE,MAAM,GAAG,QAAQ,CAAC;wBAClB,EAAE,GAAG,MAAM,CAAC,EAAE,EAAE,CAAC;wBACjB,SAAS,GAAG,IAAI,CAAC,mBAAmB;4BACvC,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,SAAS,KAAK,MAAM;4BAC/C,CAAC,CAAC,IAAI,CAAC;wBACJ,SAAS,GAAG,IAAI,CAAC,mBAAmB;4BACvC,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,SAAS,KAAK,MAAM;4BAC/C,CAAC,CAAC,KAAK,CAAC;wBACL,OAAO,GAAG,IAAI,CAAC,mBAAmB;4BACrC,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,OAAO,KAAK,MAAM;4BAC7C,CAAC,CAAC,KAAK,CAAC;wBACL,OAAO,GAAG,IAAI,CAAC;wBAGf,KAAK,GAAG,IAAI,CAAC,MAAM;4BACtB,CAAC,CAAC,IAAI,CAAC,MAAM;4BACb,CAAC,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC;wBAIf,KAAK,GAAG,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC;wBAC1B,SAAS,GAAG,MAAM,CAAC,SAAS,EAAE,CAAC;wBAEnC,IAAI,IAAI,CAAC,MAAM,EAAE;4BAChB,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC;yBACpB;6BACI,IAAG,SAAS,CAAC,MAAM,EAAE;4BACzB,KAAK,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;yBACrB;wBAGG,KAAK,GAAG,IAAI,CAAC,MAAM;4BACtB,CAAC,CAAC,IAAI,CAAC,MAAM;4BACb,CAAC,CAAC,KAAK,CAAC;wBAEL,SAAS,GAAG,IAAI,CAAC,SAAS;4BAC7B,CAAC,CAAC,IAAI,CAAC,SAAS;4BAChB,CAAC,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,EAAD,CAAC,CAAC;wBAGN,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC;wBAElC,IAAI,UAAU,EAAE;4BACf,KAAS,CAAC,GAAC,CAAC,EAAG,CAAC,GAAC,UAAU,CAAC,MAAM,EAAG,CAAC,EAAE,EAAE;gCACrC,KAAK,GAAG,KAAK,CAAC;gCAElB,KAAS,CAAC,GAAC,CAAC,EAAG,CAAC,GAAC,IAAI,CAAC,MAAM,EAAG,CAAC,EAAE,EAAE;oCACnC,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,KAAK,KAAK,UAAU,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE;wCAC1C,KAAK,GAAG,IAAI,CAAC;qCACb;iCACD;gCAED,IAAI,CAAE,KAAK,EAAE;oCACZ,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;iCACzB;6BACD;yBACD;wBAGG,CAAC,GAAG,EAAE;6BACR,QAAQ,EAAE;6BACV,MAAM,CAAC,KAAK,GAAG,WAAW,EAAE,KAAK,GAAG,WAAW,CAAC;6BAChD,IAAI,CAAC,KAAK,CAAC;6BACX,OAAO,CAAC,KAAK,CAAC,CAAC;wBAEjB,IAAI,IAAI,CAAC,MAAM,EAAE;4BAChB,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;yBACrB;wBAED,8DAA8D;wBAC9D,IAAI,SAAS,EAAE;4BACd,CAAC,CAAC,KAAK,CAAC,EAAC,KAAK,EAAE,GAAG,EAAC,CAAC,CAAC;yBACtB;wBAED,IAAA,kBAAQ,EAAC,CAAC,EAAE,IAAI,CAAC,CAAC;wBAElB,IAAI,IAAI,CAAC,MAAM,EAAE;4BAChB,8EAA8E;4BAC9E,sEAAsE;4BACtE,mBAAmB;4BACnB,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,OAAO,CAAC,UAAC,GAAG;gCAClC,IAAI,GAAG,GAAG,GAAG,CAAC,iBAAiB,EAAE;qCAC/B,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC;qCACnB,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC;qCACnB,IAAI,EAAE,CAAC;gCAET,IAAI,CAAE,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAE;oCAC3B,CAAC,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;iCACd;4BACF,CAAC,CAAC,CAAC;4BAEH,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;yBACvB;wBAEU,qBAAM,CAAC,EAAA;;wBAAd,IAAI,GAAG,SAAO;wBAElB,4FAA4F;wBAC5F,IAAI,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,EAAE;4BACnD,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,KAAK,EAAP,CAAO,CAAC,CAAC;4BAChC,QAAQ,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC;4BAE9C,KAAS,CAAC,GAAC,QAAQ,CAAC,MAAM,GAAC,CAAC,EAAG,CAAC,IAAE,CAAC,EAAG,CAAC,EAAE,EAAE;gCAC1C,IAAI,CAAE,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,EAAE;oCACnC,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;iCAC5C;6BACD;yBACD;6BAGG,CAAA,SAAS,IAAI,OAAO,CAAA,EAApB,wBAAoB;wBACnB,KAAK,GAAG,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;wBAE5B,IAAA,kBAAQ,EAAC,KAAK,EAAE,IAAI,CAAC,CAAC;wBAEtB,IAAI,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,CAAE,KAAK,CAAC,QAAQ,EAAE,EAAE;4BAC7C,KAAK;iCACH,QAAQ,EAAE;iCACV,MAAM,CAAC,KAAK,GAAG,WAAW,CAAC;iCAC3B,OAAO,CAAC,KAAK,CAAC,CAAC;4BAEjB,+EAA+E;4BAC/E,oFAAoF;4BACpF,IAAI,SAAS,EAAE;gCACd,KAAK,CAAC,KAAK,CAAC,EAAC,KAAK,EAAE,GAAG,EAAC,CAAC,CAAC;6BAC1B;iCACI;gCACJ,KAAK,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;6BAC7B;yBACD;4CAGQ,GAAG;4BACX,IAAI,GAAG,GAAG,KAAK,CAAC;4BAChB,IAAI,OAAO,GAAG,GAAG,CAAC,IAAI,EAAE,CAAC;4BAEzB,gGAAgG;4BAChG,4GAA4G;4BAC5G,IAAI,IAAI,CAAC,eAAe,IAAI,KAAK,CAAC,IAAI,EAAE,KAAK,IAAI,CAAC,eAAe,EAAE;gCAClE,IAAI,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,KAAK,SAAS,IAAI,OAAO,KAAK,IAAI,CAAC,eAAe,EAAE;oCAChF,GAAG,GAAG,IAAI,CAAC;iCACX;6BACD;iCACI,IAAI,IAAI,CAAC,WAAW,IAAI,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,KAAK,SAAS,EAAE;gCACrE,GAAG,GAAG,IAAI,CAAC;6BACX;4BAED,IAAI,GAAG,EAAE;gCACR,KAAK,CAAC,KAAK,CAAC;oCACX,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;wCAC1D,IAAG,IAAI,CAAC,gBAAgB,KAAK,SAAS,IAAI,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,EAAE;4CAC5E,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;yCAC1B;6CACI;4CACJ,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;yCACpD;qCACD;gCACF,CAAC,CAAC,CAAC;6BACH;;wBA3BF,0EAA0E;wBAC1E,WAAsB,EAAN,iBAAM,EAAN,oBAAM,EAAN,IAAM;4BAAb,GAAG;oCAAH,GAAG;yBA2BX;wBAEiB,qBAAM,KAAK,EAAA;;wBAAzB,WAAW,GAAG,SAAW;wBAE7B,+BAA+B;wBAC/B,OAAO,GAAG,EAAE,CAAC;wBACb,WAAW,CAAC,OAAO,CAAC,UAAA,CAAC;4BACpB,OAAO,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;wBACtB,CAAC,CAAC,CAAC;;;wBAGA,GAAG,GAAG,EAAE,CAAC;wBAEb,KAAS,CAAC,GAAC,CAAC,EAAG,CAAC,GAAC,IAAI,CAAC,MAAM,EAAG,CAAC,EAAE,EAAE;4BAC/B,GAAG,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;4BACd,UAAQ,GAAG,CAAC,KAAK,CAAC;4BAClB,KAAK,GAAG,GAAG,CAAC,KAAK,KAAK,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC;4BACnD,KAAK,GAAG,KAAK,CAAC;4BAElB,IAAI,OAAO,EAAE;gCACZ,KAAK,GAAG,OAAO,CAAC,OAAK,CAAC,IAAI,OAAO,CAAC,OAAK,CAAC,CAAC,KAAK;oCAC7C,CAAC,CAAC,OAAO,CAAC,OAAK,CAAC,CAAC,KAAK;oCACtB,CAAC,CAAC,CAAC,CAAC;gCAEL,qDAAqD;gCACrD,+CAA+C;gCAC/C,IAAI,KAAK,KAAK,IAAI,EAAE;oCACnB,KAAK,GAAG,KAAK,CAAC;iCACd;6BACD;4BAED,GAAG,CAAC,IAAI,CAAC;gCACR,KAAK,EAAE,SAAS,CAAC,GAAG,CAAC,KAAK,CAAC;gCAC3B,KAAK,EAAE,KAAK;gCACZ,KAAK,EAAE,OAAK;gCACZ,KAAK,EAAE,KAAK;6BACZ,CAAC,CAAC;yBACH;wBAED,4CAA4C;wBAC5C,IAAI,CAAE,IAAI,CAAC,MAAM,EAAE;4BAClB,GAAG,CAAC,IAAI,CAAC,UAAS,CAAC,EAAE,CAAC;gCACrB,IAAI,SAAS,CAAC,CAAC,CAAC,IAAI,SAAS,CAAC,CAAC,CAAC,EAAE;oCACjC,OAAO,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;iCACrC;gCACD,OAAO,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;oCACzB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC,CAAC;oCACvB,CAAC,CAAC,CAAC;oCACH,CAAC,CAAC;4BACL,CAAC,CAAC,CAAC;yBACH;wBAED,sBAAO,GAAG,EAAC;;;;KACX;IACF,wBAAC;AAAD,CA5ZA,AA4ZC,IAAA","file":"searchPaneOptions.js","sourcesContent":["import * as knex from 'knex';\nimport {Knex} from 'knex';\n\nimport Field from './field';\nimport Editor, {ILeftJoin} from './editor';\nimport {leftJoin} from './helpers';\n\nfunction isNumeric(n) {\n\treturn !isNaN(parseFloat(n)) && isFinite(n);\n}\n\nexport interface IOption {\n\tlabel: string;\n\tvalue: string | number;\n}\nexport type IRenderer = (str: string) => string;\nexport type CustomOptions = (db: Knex) => Promise<IOption[]>;\n\n/**\n * The Options class provides a convenient method of specifying where Editor\n * should get the list of options for a `select`, `radio` or `checkbox` field.\n * This is normally from a table that is _left joined_ to the main table being\n * edited, and a list of the values available from the joined table is shown to\n * the end user to let them select from.\n *\n * `Options` instances are used with the {@link Field.options} method.\n *\n * @export\n * @class Options\n */\nexport default class SearchPaneOptions {\n\tprivate _table: string;\n\tprivate _value: string;\n\tprivate _label: string[];\n\tprivate _leftJoin: ILeftJoin[] = [];\n\tprivate _renderer: IRenderer;\n\tprivate _where: any;\n\tprivate _order: string;\n\n\t/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\n\t * Public methods\n\t */\n\n\t/**\n\t * Get the column(s) to be used for the label\n\t *\n\t * @returns {string[]} Label columns\n\t */\n\tpublic label(): string[];\n\t/**\n\t * Set the column(s) to be used for the label\n\t *\n\t * @param {string[]} label Database column names\n\t * @returns {Options} Self for chaining\n\t */\n\tpublic label(label: string[]): SearchPaneOptions;\n\tpublic label(label?: string[]): any {\n\t\tif (label === undefined) {\n\t\t\treturn this._label;\n\t\t}\n\n\t\tthis._label = Array.isArray(label) ?\n\t\t\tlabel :\n\t\t\t[label];\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get the ORDER BY clause for the SQL.\n\t *\n\t * @returns {string} ORDER BY clause\n\t */\n\tpublic order(): string;\n\t/**\n\t * Set the ORDER BY clause to use in the SQL. If this option is not\n\t * provided the ordering will be based on the rendered output, either\n\t * numerically or alphabetically based on the data returned by the renderer.\n\t *\n\t * @param {string} order ORDER BY statement\n\t * @returns {Options} Self for chaining\n\t */\n\tpublic order(order: string): SearchPaneOptions;\n\tpublic order(order?: string): any {\n\t\tif (order === undefined) {\n\t\t\treturn this._order;\n\t\t}\n\n\t\tthis._order = order;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get the configured label renderer\n\t *\n\t * @returns {IRenderer} Self for chaining\n\t */\n\tpublic render(): IRenderer;\n\t/**\n\t * Set the label renderer. The renderer can be used to combine\n\t * multiple database columns into a single string that is shown as the label\n\t * to the end user in the list of options.\n\t *\n\t * @param {IRenderer} fn Renderering function\n\t * @returns {Options} Self for chaining\n\t */\n\tpublic render(fn: IRenderer): SearchPaneOptions;\n\tpublic render(fn?: IRenderer): any {\n\t\tif (fn === undefined) {\n\t\t\treturn this._renderer;\n\t\t}\n\n\t\tthis._renderer = fn;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get the table that the options will be gathered from.\n\t *\n\t * @returns {string} Table name\n\t */\n\tpublic table(): string;\n\t/**\n\t * Set the database table from which to gather the options for the list.\n\t *\n\t * @param {string} table Table name\n\t * @returns {Options} Self for chaining\n\t */\n\tpublic table(table: string): SearchPaneOptions;\n\tpublic table(table?: string): any {\n\t\tif (table === undefined) {\n\t\t\treturn this._table;\n\t\t}\n\n\t\tthis._table = table;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get the column name to use for the value in the options list.\n\t *\n\t * @returns {string} Column name\n\t */\n\tpublic value(): string;\n\t/**\n\t * Set the column name to use for the value in the options list. This would\n\t * normally be the primary key for the table.\n\t *\n\t * @param {string} value Column name\n\t * @returns {Options} Self for chaining\n\t */\n\tpublic value(value: string): SearchPaneOptions;\n\tpublic value(value?: string): any {\n\t\tif (value === undefined) {\n\t\t\treturn this._value;\n\t\t}\n\n\t\tthis._value = value;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get the WHERE condition for this option set.\n\t *\n\t * @returns {*} Knex WHERE condition\n\t */\n\tpublic where(): any;\n\t/**\n\t * Set the method to use for a WHERE condition if one is to be applied to\n\t * the query to get the options.\n\t *\n\t * @param {*} where Knex WHERE condition\n\t * @returns {Options} Self for chaining\n\t */\n\tpublic where(where: any): SearchPaneOptions;\n\tpublic where(where?: any): any {\n\t\tif (where === undefined) {\n\t\t\treturn this._where;\n\t\t}\n\n\t\tthis._where = where;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Set the method to use for a leftJoin condition if one is to be applied\n\t * to the query to retrieve data from two tables\n\t *\n\t * @param table the table for the join\n\t * @param field1 the first field\n\t * @param operator operator for the join\n\t * @param field2 the second field\n\t */\n\tpublic leftJoin(table: string, field1: string | Function, operator: string, field2: string): this {\n\t\tif (typeof field1 === 'function') {\n\t\t\tthis._leftJoin.push({\n\t\t\t\tfield1: '',\n\t\t\t\tfield2: '',\n\t\t\t\tfn: field1,\n\t\t\t\toperator: '',\n\t\t\t\ttable,\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\tthis._leftJoin.push({\n\t\t\t\tfield1,\n\t\t\t\tfield2,\n\t\t\t\toperator,\n\t\t\t\ttable,\n\t\t\t});\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\n\t * Internal methods\n\t */\n\n\t/**\n\t * Execution function for getting the SearchPane options\n\t * @param field The field to retrieve data from\n\t * @param editor The editor instance\n\t * @param http The http sent to the server\n\t * @param fieldsIn All of the fields\n\t * @param leftJoinIn Info for a leftJoin if required\n\t */\n\tpublic async exec(\n\t\tfield: Field, editor: Editor, http: any, fieldsIn: any, leftJoinIn: any\n\t): Promise<IOption[]> {\n\t\tlet fields = fieldsIn;\n\t\tlet db = editor.db();\n\t\tlet viewCount = http.searchPanes_options\n\t\t\t? http.searchPanes_options.viewCount === 'true'\n\t\t\t: true;\n\t\tlet viewTotal = http.searchPanes_options\n\t\t\t? http.searchPanes_options.viewTotal === 'true'\n\t\t\t: false;\n\t\tlet cascade = http.searchPanes_options\n\t\t\t? http.searchPanes_options.cascade === 'true'\n\t\t\t: false;\n\t\tlet entries = null;\n\n\t\t// If the value is not yet set then set the variable to be the field name\n\t\tlet value = this._value\n\t\t\t? this._value\n\t\t\t: field.dbField();\n\n\t\t// If the table is not yet set then set the table variable to be the same as editor\n\t\t// This is not taking a value from the SearchPaneOptions instance as the table should be defined in value/label. This throws up errors if not.\n\t\tlet table = editor.table()[0];\n\t\tlet readTable = editor.readTable();\n\n\t\tif (this._table) {\n\t\t\ttable = this._table;\n\t\t}\n\t\telse if(readTable.length) {\n\t\t\ttable = readTable[0];\n\t\t}\n\n\t\t// If the label value has not yet been set then just set it to be the same as value\n\t\tlet label = this._label\n\t\t\t? this._label\n\t\t\t: value;\n\n\t\tlet formatter = this._renderer\n\t\t\t? this._renderer\n\t\t\t: d => d;\n\n\t\t// Use Editor's left joins and merge in any additional from this instance\n\t\tlet join = this._leftJoin.slice();\n\n\t\tif (leftJoinIn) {\n\t\t\tfor (let i=0 ; i<leftJoinIn.length ; i++) {\n\t\t\t\tlet found = false;\n\n\t\t\t\tfor (let j=0 ; j<join.length ; j++) {\n\t\t\t\t\tif (join[j].table === leftJoinIn[i].table) {\n\t\t\t\t\t\tfound = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (! found) {\n\t\t\t\t\tjoin.push(leftJoinIn[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Get the data for the pane options\n\t\tlet q = db\n\t\t\t.distinct()\n\t\t\t.select(label + ' as label', value + ' as value')\n\t\t\t.from(table)\n\t\t\t.groupBy(value);\n\n\t\tif (this._where) {\n\t\t\tq.where(this._where);\n\t\t}\n\n\t\t// If not cascading, then the total and count must be the same\n\t\tif (viewTotal) {\n\t\t\tq.count({total: '*'});\n\t\t}\n\n\t\tleftJoin(q, join);\n\n\t\tif (this._order) {\n\t\t\t// For cases where we are ordering by a field which isn't included in the list\n\t\t\t// of fields to display, we need to add the ordering field, due to the\n\t\t\t// select distinct.\n\t\t\tthis._order.split(',').forEach((val) => {\n\t\t\t\tlet fie = val.toLocaleLowerCase()\n\t\t\t\t\t.replace(' asc', '')\n\t\t\t\t\t.replace('desc', '')\n\t\t\t\t\t.trim();\n\n\t\t\t\tif (! fields.includes(fie)) {\n\t\t\t\t\tq.select(fie);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tq.orderBy(this._order);\n\t\t}\n\n\t\tlet rows = await q;\n\n\t\t// Remove any filtering entries that don't exist in the database (values might have changed)\n\t\tif (http.searchPanes && http.searchPanes[field.name()]) {\n\t\t\tlet values = rows.map(r => r.value);\n\t\t\tlet selected = http.searchPanes[field.name()];\n\n\t\t\tfor (let i=selected.length-1 ; i>=0 ; i--) {\n\t\t\t\tif (! values.includes(selected[i])) {\n\t\t\t\t\thttp.searchPanes[field.name()].splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Apply filters to cascade tables\n\t\tif (viewCount || cascade) {\n\t\t\tlet query = db.table(table);\n\n\t\t\tleftJoin(query, join);\n\n\t\t\tif (field.apply('get') && ! field.getValue()) {\n\t\t\t\tquery\n\t\t\t\t\t.distinct()\n\t\t\t\t\t.select(value + ' as value')\n\t\t\t\t\t.groupBy(value);\n\n\t\t\t\t// We viewTotal is enabled, we need to do a count to get the number of records,\n\t\t\t\t// If it isn't we still need to know it exists, but don't care about the cardinality\n\t\t\t\tif (viewCount) {\n\t\t\t\t\tquery.count({count: '*'});\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tquery.select('(1) as count');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Construct the where queries based upon the options selected by the user\n\t\t\tfor (let fie of fields) {\n\t\t\t\tlet add = false;\n\t\t\t\tlet fieName = fie.name();\n\n\t\t\t\t// If there is a last value set then a slightly different set of results is required for cascade\n\t\t\t\t// That panes results are based off of the results when only considering the selections of all of the others\n\t\t\t\tif (http.searchPanesLast && field.name() === http.searchPanesLast) {\n\t\t\t\t\tif (http.searchPanes[fieName] !== undefined && fieName !== http.searchPanesLast) {\n\t\t\t\t\t\tadd = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (http.searchPanes && http.searchPanes[fieName] !== undefined) {\n\t\t\t\t\tadd = true;\n\t\t\t\t}\n\n\t\t\t\tif (add) {\n\t\t\t\t\tquery.where(function() {\n\t\t\t\t\t\tfor (let i = 0; i < http.searchPanes[fieName].length; i++) {\n\t\t\t\t\t\t\tif(http.searchPanes_null !== undefined && http.searchPanes_null[fieName][i]) {\n\t\t\t\t\t\t\t\tthis.orWhereNull(fieName);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tthis.orWhere(fieName, http.searchPanes[fieName][i]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet entriesRows = await query;\n\n\t\t\t// Key by value for fast lookup\n\t\t\tentries = {};\n\t\t\tentriesRows.forEach(r => {\n\t\t\t\tentries[r.value] = r;\n\t\t\t});\n\t\t}\n\n\t\tlet out = [];\n\t\t\n\t\tfor (let i=0 ; i<rows.length ; i++) {\n\t\t\tlet row = rows[i];\n\t\t\tlet value = row.value;\n\t\t\tlet total = row.total !== undefined ? row.total : null;\n\t\t\tlet count = total;\n\n\t\t\tif (entries) {\n\t\t\t\tcount = entries[value] && entries[value].count\n\t\t\t\t\t? entries[value].count\n\t\t\t\t\t: 0;\n\n\t\t\t\t// For when viewCount is enabled and viewTotal is not\n\t\t\t\t// the total needs to be the same as the count!\n\t\t\t\tif (total === null) {\n\t\t\t\t\ttotal = count;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tout.push({\n\t\t\t\tlabel: formatter(row.label),\n\t\t\t\ttotal: total,\n\t\t\t\tvalue: value,\n\t\t\t\tcount: count\n\t\t\t});\n\t\t}\n\n\t\t// Only sort if there was no SQL order field\n\t\tif (! this._order) {\n\t\t\tout.sort(function(a, b) {\n\t\t\t\tif (isNumeric(a) && isNumeric(b)) {\n\t\t\t\t\treturn (a.label * 1) - (b.label * 1);\n\t\t\t\t}\n\t\t\t\treturn a.label < b.label ?\n\t\t\t\t\t-1 : a.label > b.label ?\n\t\t\t\t\t\t1 :\n\t\t\t\t\t\t0;\n\t\t\t});\n\t\t}\n\n\t\treturn out;\n\t}\n}\n"]}