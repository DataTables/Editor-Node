{"version":3,"sources":["editor.ts"],"names":[],"mappings":"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","file":"editor.js","sourcesContent":["import * as crc from 'crc';\nimport * as knex from 'knex';\n\nimport Field, {SetType} from './field';\nimport Format from './formatters';\nimport Mjoin from './mjoin';\nimport NestedData from './nestedData';\nimport {IUpload} from './upload';\nimport Validate from './validators';\n\n/**\n * Action that has been requested by the client-side\n * (based on the `action` parameter).\n * @export\n */\nexport enum Action {\n\t/** Get data (used by DataTables). */\n\tRead,\n\n\t/** Create a new row. */\n\tCreate,\n\n\t/** Edit one or more rows. */\n\tEdit,\n\n\t/** Delete one or more rows. */\n\tDelete,\n\n\t/** Upload a file. */\n\tUpload\n}\n\n/**\n * Field error object.\n * @export\n */\nexport interface IDtError {\n\t/** Field name in error. */\n\tname: string;\n\n\t/** Error message string. */\n\tstatus: string;\n}\n\n/**\n * DataTables request's order object.\n * @export\n */\nexport interface IDtOrder {\n\t/** Sorting direction. */\n\tdir: 'asc'|'desc';\n\n\t/** Column index to sort by. */\n\tcolumn: number;\n}\n\n/**\n * DataTables request's column information object.\n * @export\n */\nexport interface IDtColumn {\n\t/** Data property (`columns.data`). */\n\tdata: string;\n\n\t/** Searchable flag. */\n\n\tsearchable: boolean;\n\n\t/** Search information object. */\n\tsearch: {\n\t\t/** Search string. */\n\t\tvalue: string;\n\t};\n}\n\n/**\n * DataTables request object. This is the information that DataTables\n * and Editor can send to the server.\n * @export\n */\nexport interface IDtRequest {\n\t/** Editor - Action being requested. */\n\taction?: string;\n\n\t/** Editor - Data being sent for create / edit / delete. */\n\tdata?: object[];\n\n\t/** DataTables SSP - Draw counter. */\n\tdraw?: number;\n\n\t/** DataTables SSP - paging start point. */\n\tstart?: number;\n\n\t/** DataTables SSP - paging length. */\n\tlength?: number;\n\n\t/** DataTables SSP - ordering. */\n\torder?: IDtOrder[];\n\n\t/** DataTables SSP - column information. */\n\tcolumns?: IDtColumn[];\n\n\t/** DataTables SSP - Global search value. */\n\tsearch?: {\n\t\tvalue: string;\n\t};\n\n\t/** Editor - Upload field name. */\n\tuploadField?: string;\n}\n\n/**\n * Response object for DataTables and Editor\n * @export\n */\nexport interface IDtResponse {\n\t/** DataTables - Array of row information. */\n\tdata?: object[];\n\n\t/** Editor - Rows which have not been acted upon. */\n\tcancelled?: string[];\n\n\t/** DataTables and Editor - General error string. */\n\terror?: string;\n\n\t/** Editor - Field information errors. */\n\tfieldErrors?: IDtError[];\n\n\t/** Editor - `select`, `radio` and `checkbox` options. */\n\toptions?: object;\n\n\t/** Editor - file information. */\n\tfiles?: object;\n\n\t/** DataTables SSP - draw counter. */\n\tdraw?: number;\n\n\t/** DataTables SSP - number of records in the result set. */\n\trecordsTotal?: number;\n\n\t/** DataTables SSP - number of records after filtering. */\n\trecordsFiltered?: number;\n\n\t/** Editor - Upload complete file id. */\n\tupload?: {\n\t\tid: string\n\t};\n\n\t/** Debug information if enabled by Editor.debug() */\n\tdebug?: any[];\n}\n\n/**\n * Global validation is performed when Editor submits a create, edit or\n * delete request. The function can be useful for cases where fields must\n * be validates together, rather than individually.\n */\nexport type IGlobalValidator =\n\t( editor: Editor, action: string, http: IDtRequest ) => Promise<true|string>;\n\n/**\n * Server-side processing object structure\n * @interface ISSP\n * @private\n */\ninterface ISSP {\n\tdraw?: number;\n\trecordsFiltered?: number;\n\trecordsTotal?: number;\n}\n\n/**\n * Left join object structure\n * @interface ILeftJoin\n * @private\n */\ninterface ILeftJoin {\n\ttable: string;\n\tfield1: string;\n\tfield2: string;\n\toperator: string;\n}\n\n/**\n * DataTables Editor base class for creating editable tables.\n *\n * Editor class instances are capable of servicing all of the requests that\n * DataTables and Editor will make from the client-side - specifically:\n *\n * * Get data\n * * Create new record\n * * Edit existing record\n * * Delete existing records\n *\n * The Editor instance is configured with information regarding the\n * database table fields that you which to make editable, and other information\n * needed to read and write to the database (table name for example!).\n *\n * This documentation is very much focused on describing the API presented\n * by these DataTables Editor classes. For a more general overview of how\n * the Editor class is used, and how to install Editor on your server, please\n * refer to the {@link http://editor.datatables.net/manual Editor manual}.\n *\n * @export\n * @class Editor\n * @extends {NestedData}\n */\nexport default class Editor extends NestedData {\n\tpublic static Action = Action;\n\n\tpublic static version: string = '1.9.2';\n\n\t/**\n\t * Determine the request type from an HTTP request.\n\t *\n\t * @static\n\t * @param {IDtRequest} http HTTP request - normally `request.body`. Note that\n\t *   if you are using `body-parser` you should use `{ extended: true }` as its\n\t *   options to ensure that nested properties are correctly resolved.\n\t * @returns {Action} Indicates what action the request is\n\t */\n\tpublic static action( http: IDtRequest ): Action {\n\t\tif ( ! http || ! http.action ) {\n\t\t\treturn Action.Read;\n\t\t}\n\n\t\tswitch ( http.action ) {\n\t\t\tcase 'create':\n\t\t\t\treturn Action.Create;\n\n\t\t\tcase 'edit':\n\t\t\t\treturn Action.Edit;\n\n\t\t\tcase 'remove':\n\t\t\t\treturn Action.Delete;\n\n\t\t\tcase 'upload':\n\t\t\t\treturn Action.Upload;\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error( 'Unknown Editor action: ' + http.action );\n\t\t}\n\t}\n\n\tprivate _db: knex;\n\tprivate _fields: Field[] = [];\n\tprivate _formData;\n\tprivate _processData;\n\tprivate _idPrefix: string = 'row_';\n\tprivate _join: Mjoin[] = [];\n\tprivate _pkey: string[] = ['id'];\n\tprivate _table: string[] = [];\n\tprivate _readTableNames: string[] = [];\n\tprivate _transaction: boolean = false;\n\tprivate _where = [];\n\tprivate _leftJoin: ILeftJoin[] = [];\n\tprivate _out: IDtResponse = {};\n\tprivate _events = [];\n\tprivate _validators: IGlobalValidator[] = [];\n\tprivate _tryCatch: boolean = false;\n\tprivate _knexTransaction: knex;\n\tprivate _uploadData: IUpload;\n\tprivate _debug: boolean = false;\n\tprivate _debugInfo: any[] = [];\n\tprivate _leftJoinRemove: boolean = false;\n\tprivate _schema: string = null;\n\n\t/**\n\t * Creates an instance of Editor.\n\t * @param {knex} [db=null] Database connection object\n\t * @param {(string|string[])} [table=null] The table name in the database to\n\t *   read and write information from and to. Can be given here or with the\n\t *   'table' method.\n\t * @param {(string|string[])} [pkey=null] Primary key column name in the\n\t *   table given in\n\t */\n\tconstructor( db: knex = null, table: string|string[] = null, pkey: string|string[] = null ) {\n\t\tsuper();\n\n\t\tif ( db ) {\n\t\t\tthis.db( db );\n\t\t}\n\n\t\tif ( table ) {\n\t\t\tthis.table( table );\n\t\t}\n\n\t\tif ( pkey ) {\n\t\t\tthis.pkey( pkey );\n\t\t}\n\t}\n\n\t/**\n\t * Get the data constructed in this instance.\n\t * @returns {IDtResponse} Data object\n\t */\n\tpublic data(): IDtResponse {\n\t\treturn this._out;\n\t}\n\n\t/**\n\t * Get the database connection assigned to the instance.\n\t * @returns {knex} Knex db interface\n\t */\n\tpublic db(): knex;\n\t/**\n\t * Set the database connection.\n\t * @param {knex} Knex db interface\n\t * @returns {Editor} Self for chaining\n\t */\n\tpublic db(db: knex): Editor;\n\tpublic db(db?: knex): any {\n\t\tif ( db === undefined ) {\n\t\t\tif ( this._knexTransaction ) {\n\t\t\t\treturn this._knexTransaction;\n\t\t\t}\n\t\t\telse if ( this._schema ) {\n\t\t\t\treturn this._db.withSchema(this._schema);\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn this._db;\n\t\t\t}\n\t\t}\n\n\t\tthis._db = db;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get the debug setting for this instance\n\t * @returns {boolean} Debug enabled (true) or not\n\t */\n\tpublic debug(): boolean;\n\t/**\n\t * Set the debug setting for this instance\n\t * @param {boolean} set Debug flag\n\t * @returns {Editor} Self for chaining\n\t */\n\tpublic debug(set: boolean): Editor;\n\t/**\n\t * Add a debug message\n\t * @param {any} message Message to add\n\t * @returns {Editor} Self for chaining\n\t */\n\tpublic debug(message: any): Editor;\n\tpublic debug(param?: any): any {\n\t\tif ( param === undefined ) {\n\t\t\treturn this._debug;\n\t\t}\n\t\telse if ( param === true || param === false ) {\n\t\t\tthis._debug = param;\n\t\t\treturn this;\n\t\t}\n\n\t\t// Otherwise its a message\n\t\tthis._debugInfo.push( param );\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Add a new field to the Editor instance\n\t * @param field Field instance to add=\n\t * @returns {Editor} Editor instance\n\t */\n\tpublic field( field: Field ): Editor;\n\t/**\n\t * Get a field\n\t * @param name Field name to get\n\t * @returns {Field} Field instance\n\t */\n\tpublic field( name: string ): Field;\n\tpublic field( nameOrField: any ): any {\n\t\tif ( typeof nameOrField === 'string' ) {\n\t\t\tfor ( let i = 0, ien = this._fields.length; i < ien; i++ ) {\n\t\t\t\tif ( this._fields[i].name() === nameOrField ) {\n\t\t\t\t\treturn this._fields[i];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthrow new Error( 'Unknown field: ' + nameOrField );\n\t\t}\n\n\t\tthis._fields.push( nameOrField );\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get the fields assigned to this instance.\n\t * @returns {Field[]} Array of fields\n\t */\n\tpublic fields(): Field[];\n\t/**\n\t * Add one or more fields to the instance.\n\t * @param {...Field[]} fields Fields to add\n\t * @returns {Editor} Self for chaining\n\t */\n\tpublic fields(...fields: Field[]): Editor;\n\tpublic fields(...fields: Field[]): any {\n\t\tif ( fields === undefined || fields.length === 0 ) {\n\t\t\treturn this._fields;\n\t\t}\n\n\t\tthis._fields.push.apply( this._fields, fields );\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get the id prefix.\n\t *\n\t * Typically primary keys are numeric and this is not a valid ID value in an\n\t * HTML document - is also increases the likelihood of an ID clash if multiple\n\t * tables are used on a single page. As such, a prefix is assigned to the\n\t * primary key value for each row, and this is used as the DOM ID, so Editor\n\t * can track individual rows.\n\t * @returns {string} id prefix\n\t */\n\tpublic idPrefix(): string;\n\t/**\n\t * Get the id prefix.\n\t * @param {string} idPrefix Prefix to use.\n\t * @returns {Editor} Self for chaining\n\t */\n\tpublic idPrefix(idPrefix: string): Editor;\n\tpublic idPrefix(idPrefix?: string): any {\n\t\tif ( idPrefix === undefined ) {\n\t\t\treturn this._idPrefix;\n\t\t}\n\n\t\tthis._idPrefix = idPrefix;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get the data that is being processed by the Editor instance. This is only\n\t * useful once the `process()` method has been called, and is available for\n\t * use in validation and formatter methods.\n\t * @returns {IDtRequest} Data that has been passed into {@link Editor.process()}\n\t */\n\tpublic inData(): IDtRequest {\n\t\treturn this._processData;\n\t}\n\n\t/**\n\t * Get the configured Mjoin instances.\n\t *\n\t * Note that for the majority of use cases you will want to use the\n\t * `leftJoin()` method. It is significantly easier to use if you are just\n\t * doing a simple left join!\n\t *\n\t * The list of Join instances that Editor will join the parent table to\n\t * (i.e. the one that the {@link Editor.table} and {@link Editor.fields}\n\t * methods refer to in this class instance).\n\t *\n\t * @returns {Mjoin[]} Array of Mjoin instances\n\t */\n\tpublic join(): Mjoin[];\n\t/**\n\t * Add one or more Mjoin instances.\n\t * @param {...Mjoin[]} join Mjoin instance to add.\n\t * @returns {Editor} Self for chaining.\n\t */\n\tpublic join(...join: Mjoin[]): Editor;\n\tpublic join(...join: Mjoin[]): any {\n\t\tif ( join === undefined || join.length === 0 ) {\n\t\t\treturn this._join;\n\t\t}\n\n\t\tthis._join.push.apply( this._join, join );\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Add a left join condition to the Editor instance, allowing it to operate\n\t * over multiple tables. Multiple `leftJoin()` calls can be made for a\n\t * single Editor instance to join multiple tables.\n\t *\n\t * A left join is the most common type of join that is used with Editor\n\t * so this method is provided to make its use very easy to configure. Its\n\t * parameters are basically the same as writing an SQL left join statement,\n\t * but in this case Editor will handle the create, update and remove\n\t * requirements of the join for you:\n\t *\n\t * * Create - On create Editor will insert the data into the primary table\n\t *   and then into the joined tables - selecting the required data for each\n\t *   table.\n\t * * Edit - On edit Editor will update the main table, and then either\n\t *   update the existing rows in the joined table that match the join and\n\t *   edit conditions, or insert a new row into the joined table if required.\n\t * * Remove - On delete Editor will remove the main row and then loop over\n\t *   each of the joined tables and remove the joined data matching the join\n\t *   link from the main table.\n\t *\n\t * Please note that when using join tables, Editor requires that you fully\n\t * qualify each field with the field's table name. SQL can result table\n\t * names for ambiguous field names, but for Editor to provide its full CRUD\n\t * options, the table name must also be given. For example the field\n\t * `first_name` in the table `users` would be given as `users.first_name`.\n\t * @param {string} table Table name to do a join onto\n\t * @param {string} field1 Field from the parent table to use as the join link\n\t * @param {string} operator Join condition (`=`, '<`, etc)\n\t * @param {string} field2 Field from the child table to use as the join link\n\t * @returns {Editor} Self for chaining\n\t */\n\tpublic leftJoin( table: string, field1: string, operator: string, field2: string ): Editor {\n\t\tthis._leftJoin.push( {\n\t\t\tfield1,\n\t\t\tfield2,\n\t\t\toperator,\n\t\t\ttable,\n\t\t} );\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get the left join remove value.\n\t * @returns {boolean} Value\n\t */\n\tpublic leftJoinRemove(): boolean;\n\t/**\n\t * Indicate if a remove should be performed on left joined tables when deleting\n\t * from the parent row. Note that this is disabled by default and will be\n\t * removed completely in v2. Use `ON DELETE CASCADE` in your database instead.\n\t * @param {boolean} remove Value\n\t * @returns {Editor} Self for chaining\n\t */\n\tpublic leftJoinRemove(remove: boolean): Editor;\n\tpublic leftJoinRemove(remove?: boolean): any {\n\t\tif ( remove === undefined ) {\n\t\t\treturn this._leftJoinRemove;\n\t\t}\n\n\t\tthis._leftJoinRemove = remove;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Add an event listener. The `Editor` class will trigger an number of\n\t * events that some action can be taken on.\n\t * @param {string} name Event name\n\t * @param {Function} callback Event callback function that will be executed\n\t *   when the event occurs.\n\t * @returns {Editor} Self for chaining.\n\t */\n\tpublic on( name: string, callback: Function ): Editor {\n\t\tif ( ! this._events[ name ] ) {\n\t\t\tthis._events[ name ] = [];\n\t\t}\n\n\t\tthis._events[ name ].push( callback );\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get the database schema.\n\t *\n\t * This is used if you are using multiple schema's in your database. By default Editor\n\t * will not specify a schema, so the default search path will be used. This allows that\n\t * to be overridden.\n\t * @returns {string} Schema\n\t */\n\tpublic schema(): string;\n\t/**\n\t * Set the database schema\n\t * @param {string} schema Schema to use.\n\t * @returns {Editor} Self for chaining\n\t */\n\tpublic schema(schema: string): Editor;\n\tpublic schema(schema?: string): any {\n\t\tif ( schema === undefined ) {\n\t\t\treturn this._schema;\n\t\t}\n\n\t\tthis._schema = schema;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get CRUD read table name.\n\t * @returns {string[]} Configured read table name\n\t */\n\tpublic readTable(): string[];\n\t/**\n\t * Set CRUD read table name. If this method is used, Editor will create from the\n\t * table name(s) given rather than those given by `Editor->table()`. This can be\n\t * a useful distinction to allow a read from a VIEW (which could make use of a\n\t * complex SELECT) while writing to a different table.\n\t * @param {(string|string[])} table Database table name to use for reading from\n\t * @returns {Editor} Self for chaining\n\t */\n\tpublic readTable(table: string|string[]): Editor;\n\tpublic readTable(table?: string|string[]): any {\n\t\tif ( table === undefined || table.length === 0 ) {\n\t\t\treturn this._readTableNames;\n\t\t}\n\n\t\tif ( typeof table === 'string' ) {\n\t\t\tthis._readTableNames.push( table );\n\t\t}\n\t\telse {\n\t\t\tthis._readTableNames.push.apply( this._readTableNames, table );\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get the table name.\n\t *\n\t * The table name designated which DB table Editor will use as its data\n\t * source for working with the database. Table names can be given with an\n\t * alias, which can be used to simplify larger table names. The field\n\t * names would also need to reflect the alias, just like an SQL query. For\n\t * example: `users as a`.\n\t * @returns {string[]} Configured table name\n\t */\n\tpublic table(): string[];\n\t/**\n\t * Set the table name.\n\t * @param {(string|string[])} table Database table name to use\n\t * @returns {Editor} Self for chaining\n\t */\n\tpublic table(table: string|string[]): Editor;\n\tpublic table(table?: string|string[]): any {\n\t\tif ( table === undefined || table.length === 0 ) {\n\t\t\treturn this._table;\n\t\t}\n\n\t\tif ( typeof table === 'string' ) {\n\t\t\tthis._table.push( table );\n\t\t}\n\t\telse {\n\t\t\tthis._table.push.apply( this._table, table );\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get transaction support status\n\t *\n\t * When enabled (which it is by default) Editor will use an SQL transaction\n\t * to ensure data integrity while it is performing operations on the table.\n\t * This can be optionally disabled using this method, if required by your\n\t * database configuration.\n\t * @returns {boolean} true is transactions are enabled, false otherwise.\n\t */\n\tpublic transaction(): boolean;\n\t/**\n\t * Set transaction support state\n\t * @param {boolean} transaction Set the transaction status\n\t * @returns {Editor} Self for chaining\n\t */\n\tpublic transaction(transaction: boolean): Editor;\n\tpublic transaction(transaction?: boolean): any {\n\t\tif ( transaction === undefined ) {\n\t\t\treturn this._transaction;\n\t\t}\n\n\t\tthis._transaction = transaction;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get the primary key value.\n\t *\n\t * The primary key must be known to Editor so it will know which rows are being\n\t * edited / deleted upon those actions. The default value is ['id'].\n\t * @returns {string[]} Array of column names\n\t */\n\tpublic pkey(): string[];\n\t/**\n\t * Set the primary key value(s)\n\t * @param {string|string[]} [pkey] Primary key column name. Use an array of\n\t *   strings if using a compound key.\n\t * @returns {Editor} Self for chaining.\n\t */\n\tpublic pkey(pkey: string|string[]): Editor;\n\tpublic pkey(pkey?: string|string[]): any {\n\t\tif ( pkey === undefined ) {\n\t\t\treturn this._pkey;\n\t\t}\n\n\t\tif ( typeof pkey === 'string' ) {\n\n\t\t\tthis._pkey = [ pkey ];\n\t\t}\n\t\telse {\n\t\t\tthis._pkey = pkey;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Convert a primary key array of field values to a combined value.\n\t * @param {object} row The row of data that the primary key value should\n\t *   be extracted from.\n\t * @param {boolean} [flat=false] Flag to indicate if the given array is flat\n\t *   (useful for `where` conditions) or nested for join tables.\n\t * @returns {string} The created primary key value.\n\t */\n\tpublic pkeyToValue( row: object, flat: boolean = false ): string {\n\t\tlet pkey = this.pkey();\n\t\tlet id = [];\n\t\tlet val;\n\n\t\tfor ( let i = 0, ien = pkey.length; i < ien; i++ ) {\n\t\t\tlet column = pkey[i];\n\n\t\t\tif ( flat ) {\n\t\t\t\tval = row[ column ] !== undefined ?\n\t\t\t\t\trow[ column ] :\n\t\t\t\t\tnull;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tval = this._readProp( column, row );\n\t\t\t}\n\n\t\t\tif ( val === null ) {\n\t\t\t\tthrow new Error( 'Primary key element is not available in the data set' );\n\t\t\t}\n\n\t\t\t// Postgres gives a `Date` object for timestamps which causes issues as\n\t\t\t// a value, so convert it to be a string. Could also be done with setTypeParser\n\t\t\t// https://github.com/brianc/node-postgres/issues/1200\n\t\t\tif ( val instanceof Date ) {\n\t\t\t\tval = val.toISOString();\n\t\t\t}\n\n\t\t\tid.push( val );\n\t\t}\n\n\t\treturn id.join( this._pkeySeparator() );\n\t}\n\n\t/**\n\t * Convert a primary key combined value to an array of field values.\n\t * @param {string} value The id that should be split apart\n\t * @param {boolean} [flat=false] Flag to indicate if the returned array should be\n\t *   flat (useful for `where` conditions) or nested for join tables.\n\t * @param {string[]} [pkey=null] The primary key name - will use the instance value\n\t *   if not given\n\t * @returns {object} Array of field values that the id was made up of\n\t */\n\tpublic pkeyToObject( value: string, flat: boolean = false, pkey: string[] = null): object {\n\t\tlet arr: object = {};\n\n\t\tvalue = value.replace( this.idPrefix(), '' );\n\t\tlet idParts = value.split( this._pkeySeparator() );\n\n\t\tif ( pkey === null ) {\n\t\t\tpkey = this.pkey();\n\t\t}\n\n\t\tif ( pkey.length !== idParts.length ) {\n\t\t\tthrow new Error( 'Primary key data does not match submitted data' );\n\t\t}\n\n\t\tfor ( let i = 0, ien = idParts.length; i < ien; i++ ) {\n\t\t\tif ( flat ) {\n\t\t\t\tarr[ pkey[i] ] = idParts[i];\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._writeProp( arr, pkey[i], idParts[i] );\n\t\t\t}\n\t\t}\n\n\t\treturn arr;\n\t}\n\n\t/**\n\t * Process a request from the Editor client-side to get / set data.\n\t * @param {IDtRequest} data Form data sent from the client-side -\n\t *   e.g. `req.body`\n\t * @param {IUpload} [files=null] File information, used for upload\n\t *   requests - e.g. `req.files`\n\t * @returns {Promise<Editor>} Promise that is fulfilled when Editor\n\t *   has completed its processing - result is the Editor instance.\n\t */\n\tpublic async process( data: IDtRequest, files: IUpload = null ): Promise<Editor> {\n\t\tlet that = this;\n\t\tlet run = async function() {\n\t\t\tif ( that._tryCatch ) {\n\t\t\t\ttry {\n\t\t\t\t\tawait that._process( data, files );\n\t\t\t\t} catch ( e ) {\n\t\t\t\t\tthat._out.error = e.message;\n\t\t\t\t\t// knex does the rollback if an exception occurs\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tawait that._process( data, files );\n\t\t\t}\n\t\t};\n\n\t\tif ( this._transaction ) {\n\t\t\tawait this._db.transaction( async function(trx) {\n\t\t\t\tthat._knexTransaction = trx;\n\t\t\t\tawait run();\n\t\t\t\tthat._knexTransaction = null;\n\t\t\t} );\n\t\t}\n\t\telse {\n\t\t\tawait run();\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get the try/catch status.\n\t *\n\t * Editor uses a try/catch in the {@link Editor.process} method, and it can be\n\t * useful to disable this for debugging, but its not recommended you do that\n\t * in production.\n\t * @returns {boolean} Try / catch status.\n\t */\n\tpublic tryCatch(): boolean;\n\t/**\n\t * Set the try/catch state.\n\t * @param {boolean} tryCatch Value to set. `true` will enable, `false` disable.\n\t * @returns {Editor} Self for chaining.\n\t */\n\tpublic tryCatch(tryCatch: boolean): Editor;\n\tpublic tryCatch(tryCatch?: boolean): any {\n\t\tif ( tryCatch === undefined ) {\n\t\t\treturn this._tryCatch;\n\t\t}\n\n\t\tthis._tryCatch = tryCatch;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Perform validation on a data set.\n\t *\n\t * Note that validation is performed on data only when the action is\n\t * `create` or `edit`. Additionally, validation is performed on the _wire\n\t * data_ - i.e. that which is submitted from the client, without formatting.\n\t * Any formatting required by `setFormatter` is performed after the data\n\t * from the client has been validated.\n\t * @param {IDtError[]} errors Output array to which field error information will\n\t *   be written. Each element in the array represents a field in an error\n\t *   condition. These elements are themselves arrays with two properties\n\t *   set; `name` and `status`.\n\t * @param {IDtRequest} http The format data to check\n\t * @returns {Promise<boolean>} `true` if the data is valid, `false` if not.\n\t */\n\tpublic async validate( errors: IDtError[], http: IDtRequest ): Promise<boolean> {\n\t\tif ( http.action !== 'create' && http.action !== 'edit' ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tlet keys = Object.keys( http.data );\n\t\tlet fields = this.fields();\n\t\tlet idPrefix = this.idPrefix();\n\n\t\tfor ( let i = 0, ien = keys.length; i < ien; i++ ) {\n\t\t\tlet values = http.data[ keys[i] ];\n\n\t\t\tfor ( let j = 0, jen = fields.length; j < jen; j++ ) {\n\t\t\t\tlet field = fields[j];\n\t\t\t\tlet validation = await field.validate( values, this, keys[i].replace( idPrefix, '' ) );\n\n\t\t\t\tif ( validation !== true ) {\n\t\t\t\t\terrors.push( {\n\t\t\t\t\t\tname: field.name(),\n\t\t\t\t\t\tstatus: validation,\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// MJoin validation\n\t\t\tfor ( let j = 0, jen = this._join.length; j < jen; j++ ) {\n\t\t\t\tawait this._join[j].validate( errors, this, values, http.action );\n\t\t\t}\n\t\t}\n\n\t\treturn errors.length > 0 ?\n\t\t\tfalse :\n\t\t\ttrue;\n\t}\n\n\t/**\n\t * Get any global validator that has been set.\n\t * @returns {IGlobalValidator[]} Global validator\n\t */\n\tpublic validator(): IGlobalValidator[];\n\t/**\n\t * Set a global validator. This will be triggered for the create, edit\n\t * and remove actions performed from the client-side.\n\t * @param {IGlobalValidator} fn Function to execute when validating the input data.\n\t * @returns {Editor} Self for chaining\n\t */\n\tpublic validator(fn: IGlobalValidator): Editor;\n\tpublic validator(fn?: IGlobalValidator): any {\n\t\tif ( fn === undefined ) {\n\t\t\treturn this._validators;\n\t\t}\n\n\t\tthis._validators.push( fn );\n\t\treturn this;\n\t}\n\n\t/**\n\t * Get the array of conditions applied to the method.\n\t * @returns {any[]} Knex where conditions.\n\t */\n\tpublic where(): any[];\n\t/**\n\t * Set a condition for the queries Editor will perform. Editor uses Knex\n\t * to connect to the database, and exposes the knex object using this method\n\t * so you can add any conditions you like that are supported by Knex.\n\t * @param {*} cond Knex query condition\n\t * @returns {Editor} Self for chaining.\n\t */\n\tpublic where(...cond: any[]): Editor;\n\tpublic where(...cond: any[]): any {\n\t\tif ( cond.length === 0 ) {\n\t\t\treturn this._where;\n\t\t}\n\n\t\tthis._where.push( ...cond );\n\n\t\treturn this;\n\t}\n\n\t/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *\n\t * Private methods\n\t */\n\n\tprivate async _fileClean(): Promise<void> {\n\t\tlet that = this;\n\t\tlet run = async function( fields ) {\n\t\t\tfor ( let i = 0, ien = fields.length; i < ien; i++ ) {\n\t\t\t\tlet upload = fields[i].upload();\n\n\t\t\t\tif ( upload ) {\n\t\t\t\t\tawait upload.dbCleanExec( that, fields[i] );\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tawait run( this._fields );\n\n\t\tfor ( let i = 0, ien = this._join.length; i < ien; i++ ) {\n\t\t\tawait run( this._join[i].fields() );\n\t\t}\n\t}\n\n\tprivate async _fileData( limitTable: string = null, ids: string[] = null, data: any[] = null ): Promise<object> {\n\t\tlet files = {};\n\n\t\t// The fields in this instance\n\t\tawait this._fileDataFields( files, this._fields, limitTable, ids, data );\n\n\t\t// From joined tables\n\t\tfor ( let i = 0, ien = this._join.length; i < ien; i++ ) {\n\t\t\tlet joinData = null;\n\n\t\t\t// If we have data from the get, it is nested from the join, so we need to\n\t\t\t// un-nest it (i.e. get the array of joined data for each row)\n\t\t\tif ( data ) {\n\t\t\t\tjoinData = [];\n\n\t\t\t\tfor ( let j = 0, jen = data.length; j < jen ; j++ ) {\n\t\t\t\t\tlet innerData = data[j][this._join[i].name()];\n\n\t\t\t\t\tif ( innerData ) {\n\t\t\t\t\t\tjoinData.push.apply( joinData, innerData );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tawait this._fileDataFields( files, this._join[i].fields(), limitTable, ids, joinData );\n\t\t}\n\n\t\treturn files;\n\t}\n\n\tprivate async _fileDataFields(\n\t\tfiles: object, fields: Field[], limitTable: string, ids: string[] = null, data: any[] = null\n\t): Promise<void> {\n\t\tfor ( let i = 0, ien = fields.length; i < ien; i++ ) {\n\t\t\tlet upload = fields[i].upload();\n\n\t\t\tif ( upload ) {\n\t\t\t\tlet table = upload.table();\n\n\t\t\t\tif ( ! table ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif ( limitTable !== null && table !== limitTable ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif ( files[ table ] ) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Make a collection of the ids used in this data set to get a limited data set\n\t\t\t\t// in return (security and performance)\n\t\t\t\tif ( ids === null ) {\n\t\t\t\t\tids = [];\n\t\t\t\t}\n\n\t\t\t\tif ( data !== null ) {\n\t\t\t\t\tfor ( let j = 0, jen = data.length; j < jen; j++ ) {\n\t\t\t\t\t\tlet val = fields[i].val('set', data[j]);\n\n\t\t\t\t\t\tif ( val ) {\n\t\t\t\t\t\t\tids.push( val );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( ids.length === 0 ) {\n\t\t\t\t\t\t// If no data to fetch, then don't bother\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if ( ids.length > 1000 ) {\n\t\t\t\t\t\t// Don't use WHERE IN for really large arrays\n\t\t\t\t\t\tids = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet fileData = await upload.data( this.db(), ids );\n\n\t\t\t\tif ( fileData ) {\n\t\t\t\t\tfiles[ table ] = fileData;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _findField( name: string, type: 'db'|'name' ): Field {\n\t\tlet fields = this._fields;\n\n\t\tfor ( let i = 0, ien = fields.length; i < ien; i++ ) {\n\t\t\tlet field = fields[i];\n\n\t\t\tif ( type === 'name' && field.name() === name ) {\n\t\t\t\treturn field;\n\t\t\t}\n\t\t\telse if ( type === 'db' && field.dbField() === name ) {\n\t\t\t\treturn field;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate async _get( id: string, http: object = null ): Promise<IDtResponse> {\n\t\tlet cancel = await this._trigger( 'preGet', id );\n\t\tif ( cancel === false ) {\n\t\t\treturn {};\n\t\t}\n\n\t\tlet fields = this.fields();\n\t\tlet pkeys = this.pkey();\n\t\tlet query = this.db().table( this._readTable()[0] );\n\t\tlet options = {};\n\n\t\tfor ( let i = 0, ien = pkeys.length; i < ien; i++ ) {\n\t\t\tquery.select( pkeys[i] + ' as ' + pkeys[i] );\n\t\t}\n\n\t\tfor ( let i = 0, ien = fields.length; i < ien; i++ ) {\n\t\t\tif ( pkeys.includes( fields[i].dbField() ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif ( fields[i].apply('get') && fields[i].getValue() === undefined ) {\n\t\t\t\t// Use the `as` to ensure that the table name is included, if using a join\n\t\t\t\tlet dbField = fields[i].dbField();\n\n\t\t\t\tif ( dbField.indexOf( '(') === -1 ) {\n\t\t\t\t\tquery.select( dbField + ' as ' + dbField );\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tquery.select( this.db().raw(dbField + ' as \"' + dbField + '\"') );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._getWhere( query );\n\t\tthis._performLeftJoin( query );\n\t\tlet ssp = await this._ssp( query, http );\n\n\t\tif ( id !== null ) {\n\t\t\tquery.where( this.pkeyToObject( id, true ) );\n\t\t}\n\n\t\tlet result = await query;\n\t\tif ( ! result ) {\n\t\t\tthrow new Error( 'Error executing SQL for data get. Enable SQL debug using ' +\n\t\t\t\t'`debug: true` in your Knex db configuration'\n\t\t\t);\n\t\t}\n\n\t\tlet out = [];\n\t\tfor ( let i = 0, ien = result.length; i < ien; i++ ) {\n\t\t\tlet inner = {\n\t\t\t\tDT_RowId: this.idPrefix() + this.pkeyToValue( result[i], true )\n\t\t\t};\n\n\t\t\tfor ( let j = 0, jen = fields.length; j < jen; j++ ) {\n\t\t\t\tif ( fields[j].apply('get') ) {\n\t\t\t\t\tfields[j].write( inner, result[i] );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tout.push( inner );\n\t\t}\n\n\t\t// Field options\n\t\tif ( id === null ) {\n\t\t\tfor ( let i = 0, ien = fields.length; i < ien; i++ ) {\n\t\t\t\tlet opts = await fields[i].optionsExec( this.db() );\n\n\t\t\t\tif ( opts ) {\n\t\t\t\t\toptions[ fields[i].name() ] = opts;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Build a DtResponse object\n\t\tlet response = {\n\t\t\tdata: out,\n\t\t\tdraw: ssp.draw,\n\t\t\tfiles: {},\n\t\t\toptions,\n\t\t\trecordsFiltered: ssp.recordsFiltered,\n\t\t\trecordsTotal: ssp.recordsTotal\n\t\t};\n\n\t\t// Row based joins\n\t\tfor ( let i = 0, ien = this._join.length; i < ien; i++ ) {\n\t\t\tawait this._join[i].data( this, response );\n\t\t}\n\n\t\tresponse.files = await this._fileData( null, null, response.data );\n\n\t\tawait this._trigger( 'postGet', id, out );\n\n\t\treturn response;\n\t}\n\n\tprivate _getWhere( query: knex.QueryBuilder ): void {\n\t\tlet where = this.where();\n\n\t\tfor ( let i = 0, ien = where.length; i < ien; i++ ) {\n\t\t\tquery.where( where[i] );\n\t\t}\n\t}\n\n\tprivate async _insert( values: object ): Promise<object> {\n\t\t// Only allow a composite insert if the values for the key are\n\t\t// submitted. This is required because there is no reliable way in MySQL\n\t\t// to return the newly inserted row, so we can't know any newly\n\t\t// generated values.\n\t\tthis._pkeyValidateInsert( values );\n\n\t\t// Insert the new row\n\t\tlet id = await this._insertOrUpdate( null, values );\n\n\t\tif ( id === null ) {\n\t\t\treturn null;\n\t\t}\n\n\t\t// Was the primary key altered as part of the edit, if so use the\n\t\t// submitted values\n\t\tid = this._pkey.length > 1 ?\n\t\t\tthis.pkeyToValue( values ) :\n\t\t\tthis._pkeySubmitMerge( id, values );\n\n\t\t// Join\n\t\tfor ( let i = 0, ien = this._join.length; i < ien; i++ ) {\n\t\t\tawait this._join[i].create( this, id, values );\n\t\t}\n\n\t\tawait this._trigger( 'writeCreate', id, values );\n\n\t\tlet row = await this._get( id );\n\t\trow = row.data.length > 0 ?\n\t\t\trow.data[0] :\n\t\t\tnull;\n\n\t\tawait this._trigger( 'postCreate', id, values, row );\n\n\t\treturn row;\n\t}\n\n\tprivate async _insertOrUpdate( id: string, values: object ): Promise<string> {\n\t\t// Loop over the tables, doing the insert or update as needed\n\t\tlet tables = this.table();\n\n\t\tfor ( let i = 0, ien = tables.length; i < ien; i++ ) {\n\t\t\tlet res = await this._insertOrUpdateTable(\n\t\t\t\ttables[i],\n\t\t\t\tvalues,\n\t\t\t\tid !== null ?\n\t\t\t\t\tthis.pkeyToObject( id, true ) :\n\t\t\t\t\tnull\n\t\t\t);\n\n\t\t\t// If you don't have an id yet, then the first insert will return\n\t\t\t// the id we want\n\t\t\tif ( res !== null && id === null ) {\n\t\t\t\tid = res;\n\t\t\t}\n\t\t}\n\n\t\t// And for the left join tables\n\t\tfor ( let i = 0, ien = this._leftJoin.length; i < ien; i++ ) {\n\t\t\tlet join = this._leftJoin[i];\n\n\t\t\t// Which side of the join refers to the parent table?\n\t\t\tlet joinTable = this._alias( join.table, 'alias' );\n\t\t\tlet tablePart = this._part( join.field1 );\n\t\t\tlet parentLink;\n\t\t\tlet childLink;\n\t\t\tlet whereVal;\n\n\t\t\tif ( this._part( join.field1, 'db' ) ) {\n\t\t\t\ttablePart = this._part( join.field1, 'db' ) + '.' + tablePart;\n\t\t\t}\n\n\t\t\tif ( tablePart === joinTable ) {\n\t\t\t\tparentLink = join.field2;\n\t\t\t\tchildLink = join.field1;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tparentLink = join.field1;\n\t\t\t\tchildLink = join.field2;\n\t\t\t}\n\n\t\t\tif ( parentLink === this._pkey[0] && this._pkey.length === 1 ) {\n\t\t\t\twhereVal = id;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// We need submitted information about the joined data to be\n\t\t\t\t// submitted as well as the new value. We first check if the\n\t\t\t\t// host field was submitted\n\t\t\t\tlet field = this._findField( parentLink, 'db' );\n\n\t\t\t\tif ( ! field || ! field.apply( 'edit', values ) ) {\n\t\t\t\t\t// If not, then check if the child id was submitted\n\t\t\t\t\tfield = this._findField( childLink, 'db' );\n\n\t\t\t\t\tif ( ! field || ! field.apply( 'edit', values ) ) {\n\t\t\t\t\t\t// No data available, so we can't do anything\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twhereVal = field.val( 'set', values );\n\t\t\t}\n\n\t\t\tlet whereName = this._part( childLink, 'column' );\n\n\t\t\tawait this._insertOrUpdateTable(\n\t\t\t\tjoin.table,\n\t\t\t\tvalues,\n\t\t\t\t{ [whereName]: whereVal }\n\t\t\t);\n\t\t}\n\n\t\treturn id;\n\t}\n\n\tprivate async _insertOrUpdateTable( table: string, values: object, where: object = null ) {\n\t\tlet set = {};\n\t\tlet res;\n\t\tlet action: 'create'|'edit' = (where === null) ? 'create' : 'edit';\n\t\tlet tableAlias = this._alias( table, 'alias' );\n\t\tlet fields = this.fields();\n\n\t\tfor ( let i = 0, ien = fields.length; i < ien; i++ ) {\n\t\t\tlet field = fields[i];\n\t\t\tlet tablePart = this._part( field.dbField() );\n\n\t\t\tif ( this._part( field.dbField(), 'db' ) ) {\n\t\t\t\ttablePart = this._part( field.dbField(), 'db' ) + '.' + tablePart;\n\t\t\t}\n\n\t\t\t// Does this field apply to the table (only check when a join is\n\t\t\t// being used)\n\t\t\tif ( this._leftJoin.length && tablePart !== tableAlias ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Check if this field should be set, based on options and\n\t\t\t// submitted data\n\t\t\tif ( ! field.apply( action, values ) ) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// Some database's (specifically pg) don't like having the table\n\t\t\t// name prefixing the column name.\n\t\t\tlet fieldPart = this._part( field.dbField(), 'column' );\n\t\t\tset[ fieldPart ] = field.val( 'set', values );\n\t\t}\n\n\t\tif ( Object.keys(set).length === 0 ) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif ( action === 'create' && this.table().indexOf(table) !== -1 ) {\n\t\t\t// On the main table we get the pkey that is generated\n\t\t\tlet pkey = this._part( this._pkey[0], 'column' );\n\t\t\tres = await this\n\t\t\t\t.db()\n\t\t\t\t.insert( set )\n\t\t\t\t.table( table )\n\t\t\t\t.returning( pkey );\n\n\t\t\treturn typeof res[0] === 'object' ?\n\t\t\t\tres[0][pkey].toString() :\n\t\t\t\tres[0].toString();\n\t\t}\n\t\telse if ( action === 'create' ) {\n\t\t\t// Create on a linked table\n\t\t\tres = await this\n\t\t\t\t.db()\n\t\t\t\t.insert( set )\n\t\t\t\t.table( table );\n\t\t}\n\t\telse if ( this.table().indexOf(table) === -1 ) {\n\t\t\t// Update on a linked table - the record might not yet exist, so need to check.\n\t\t\tlet check = await this\n\t\t\t\t.db()\n\t\t\t\t.table( table )\n\t\t\t\t.select('*')\n\t\t\t\t.where( where );\n\n\t\t\tif ( check && check.length ) {\n\t\t\t\tawait this\n\t\t\t\t\t.db()\n\t\t\t\t\t.table( table )\n\t\t\t\t\t.update( set )\n\t\t\t\t\t.where( where );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tawait this\n\t\t\t\t\t.db()\n\t\t\t\t\t.table( table )\n\t\t\t\t\t.insert( Object.assign( {}, set, where ) );\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// Update on the host table\n\t\t\tawait this\n\t\t\t\t.db()\n\t\t\t\t.table( table )\n\t\t\t\t.update( set )\n\t\t\t\t.where( where );\n\t\t}\n\t}\n\n\tprivate _alias( name: string, type: 'alias'|'orig' = 'alias'): string {\n\t\tif ( name.indexOf( ' as ' ) !== -1 ) {\n\t\t\tlet a = name.split(/ as /i);\n\t\t\treturn type === 'alias' ?\n\t\t\t\ta[1] :\n\t\t\t\ta[0];\n\t\t}\n\n\t\tif ( name.indexOf( ' ' ) !== -1 ) {\n\t\t\tlet a = name.split(/ /i);\n\t\t\treturn type === 'alias' ?\n\t\t\t\ta[1] :\n\t\t\t\ta[0];\n\t\t}\n\n\t\treturn name;\n\t}\n\n\tprivate _part( name: string, type: 'table'|'db'|'column' = 'table'): string {\n\t\tlet db;\n\t\tlet table;\n\t\tlet column;\n\n\t\tif ( name.indexOf('.') !== -1 ) {\n\t\t\tlet a = name.split('.');\n\n\t\t\tif ( a.length === 3 ) {\n\t\t\t\tdb = a[0];\n\t\t\t\ttable = a[1];\n\t\t\t\tcolumn = a[2];\n\t\t\t}\n\t\t\telse if ( a.length === 2 ) {\n\t\t\t\ttable = a[0];\n\t\t\t\tcolumn = a[1];\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tcolumn = name;\n\t\t}\n\n\t\tif ( type === 'db' ) {\n\t\t\treturn db;\n\t\t}\n\t\telse if ( type === 'table' ) {\n\t\t\treturn table;\n\t\t}\n\t\treturn column;\n\t}\n\n\tprivate _prepJoin(): void {\n\t\tif ( this._leftJoin.length === 0 ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Check if the primary key has a table identifier - if not - add one\n\t\tfor ( let i = 0, ien = this._pkey.length; i < ien; i++ ) {\n\t\t\tlet val = this._pkey[i];\n\n\t\t\tif ( val.indexOf('.') === -1 ) {\n\t\t\t\tthis._pkey[i] = this._alias( this.table()[0], 'alias' ) + '.' + val;\n\t\t\t}\n\t\t}\n\n\t\t// Check that all fields have a table selector, otherwise, we'd need to\n\t\t// know the structure of the tables, to know which fields belong in\n\t\t// which. This extra requirement on the fields removes that\n\t\tfor ( let i = 0, ien = this._fields.length; i < ien; i++ ) {\n\t\t\tlet field = this._fields[i];\n\t\t\tlet name = field.dbField();\n\n\t\t\tif ( name.indexOf('.') === -1 ) {\n\t\t\t\tthrow new Error( 'Table part of the field \"' + name + '\" was not found. ' +\n\t\t\t\t\t'In Editor instances that use a join, all fields must have the ' +\n\t\t\t\t\t'database table set explicitly.'\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _performLeftJoin( query: knex.QueryBuilder ): void {\n\t\tfor ( let i = 0, ien = this._leftJoin.length; i < ien; i++ ) {\n\t\t\tlet join = this._leftJoin[i];\n\n\t\t\tquery.leftJoin( join.table, function() {\n\t\t\t\tthis.on( join.field1, join.operator, join.field2 );\n\t\t\t} );\n\t\t}\n\t}\n\n\tprivate _pkeySeparator(): string {\n\t\tlet str = this.pkey().join(',');\n\n\t\treturn crc.crc32( str ).toString(16);\n\t}\n\n\tprivate _pkeySubmitMerge( pkeyVal: string, row: object ): string {\n\t\tlet pkey = this._pkey;\n\t\tlet arr = this.pkeyToObject( pkeyVal, true );\n\n\t\tfor ( let i = 0, ien = pkey.length; i < ien; i++ ) {\n\t\t\tlet column = pkey[ i ];\n\t\t\tlet field = this._findField( column, 'db' );\n\n\t\t\tif ( field && field.apply( 'edit', row ) ) {\n\t\t\t\tarr[ column ] = field.val( 'set', row );\n\t\t\t}\n\t\t}\n\n\t\treturn this.pkeyToValue( arr, true );\n\t}\n\n\tprivate _pkeyValidateInsert( row: object ): boolean {\n\t\tlet pkey = this.pkey();\n\n\t\tif ( pkey.length === 1 ) {\n\t\t\treturn true;\n\t\t}\n\n\t\tfor ( let i = 0, ien = pkey.length; i < ien; i++ ) {\n\t\t\tlet column = pkey[i];\n\t\t\tlet field = this._findField( column, 'db' );\n\n\t\t\tif ( ! field || ! field.apply('create', row) ) {\n\t\t\t\tthrow new Error( 'When inserting into a compound key table, ' +\n\t\t\t\t\t'all fields that are part of the compound key must be ' +\n\t\t\t\t\t'submitted with a specific value.'\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate async _process( data: IDtRequest, upload: IUpload ): Promise<void> {\n\t\tthis._out = {\n\t\t\tcancelled: [],\n\t\t\tdata: [],\n\t\t\tfieldErrors: []\n\t\t};\n\n\t\tthis._processData = data;\n\t\tthis._uploadData = upload;\n\t\tthis._formData = data.data ? data.data : null;\n\t\tthis._prepJoin();\n\n\t\tfor (let validator of this._validators) {\n\t\t\tlet ret = await validator( this, data.action, data );\n\n\t\t\tif ( typeof ret === 'string' ) {\n\t\t\t\tthis._out.error = ret;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif ( data.action && data.action !== 'upload' && ! data.data ) {\n\t\t\tthis._out.error = 'No data detected. Have you used `{extended: true}` for `bodyParser`?';\n\t\t}\n\n\t\tlet action = Editor.action(data);\n\n\t\tif ( ! this._out.error ) {\n\t\t\tif ( action === Action.Read ) {\n\t\t\t\tlet outData = await this._get( null, data );\n\n\t\t\t\tthis._out.data = outData.data;\n\t\t\t\tthis._out.draw = outData.draw;\n\t\t\t\tthis._out.files = outData.files;\n\t\t\t\tthis._out.options = outData.options;\n\t\t\t\tthis._out.recordsTotal = outData.recordsTotal;\n\t\t\t\tthis._out.recordsFiltered = outData.recordsFiltered;\n\t\t\t}\n\t\t\telse if ( action === Action.Upload ) {\n\t\t\t\tawait this._upload( data );\n\t\t\t}\n\t\t\telse if ( action === Action.Delete ) {\n\t\t\t\tawait this._remove( data );\n\t\t\t\tawait this._fileClean();\n\t\t\t}\n\t\t\telse if ( action === Action.Create || action === Action.Edit ) {\n\t\t\t\t// create or edit\n\t\t\t\tlet keys = Object.keys( data.data );\n\n\t\t\t\t// Pre events so they can occur before validation, and they\n\t\t\t\t// all happen together\n\t\t\t\tfor ( let i = 0, ien = keys.length; i < ien; i++ ) {\n\t\t\t\t\tlet cancel = null;\n\t\t\t\t\tlet idSrc = keys[i];\n\t\t\t\t\tlet values = data.data[keys[i]];\n\n\t\t\t\t\tif ( action === Action.Create ) {\n\t\t\t\t\t\tcancel = await this._trigger( 'preCreate', values );\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tlet id = idSrc.replace( this.idPrefix(), '' );\n\t\t\t\t\t\tcancel = await this._trigger( 'preEdit', id, values );\n\t\t\t\t\t}\n\n\t\t\t\t\t// One of the event handlers returned false - don't continue\n\t\t\t\t\tif ( cancel === false ) {\n\t\t\t\t\t\t// Remove the data from the data set so it won't be processed\n\t\t\t\t\t\tdelete data.data[ idSrc ];\n\n\t\t\t\t\t\t// Tell the client-side we aren't updating this row\n\t\t\t\t\t\tthis._out.cancelled.push( idSrc );\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Field validation\n\t\t\t\tlet valid = await this.validate( this._out.fieldErrors, data );\n\n\t\t\t\tif ( valid ) {\n\t\t\t\t\tkeys = Object.keys( data.data );\n\n\t\t\t\t\tfor ( let i = 0, ien = keys.length; i < ien; i++ ) {\n\t\t\t\t\t\tlet d = action === Action.Create ?\n\t\t\t\t\t\t\tawait this._insert( data.data[keys[i]] ) :\n\t\t\t\t\t\t\tawait this._update( keys[i], data.data[keys[i]] );\n\n\t\t\t\t\t\tif ( d !== null ) {\n\t\t\t\t\t\t\tthis._out.data.push( d );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tawait this._fileClean();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif ( this._debug ) {\n\t\t\tthis._out.debug = this._debugInfo.slice();\n\t\t}\n\t}\n\n\tprivate _readTable(): string[] {\n\t\treturn this._readTableNames.length ?\n\t\t\tthis._readTableNames :\n\t\t\tthis._table;\n\t}\n\n\tprivate async _remove( http: IDtRequest ): Promise<void> {\n\t\tlet ids: string[] = [];\n\t\tlet keys = Object.keys( http.data );\n\n\t\tfor ( let i = 0, ien = keys.length; i < ien; i++ ) {\n\t\t\t// Strip the ID prefix that the client-side sends back\n\t\t\tlet id = keys[i].replace( this.idPrefix(), '' );\n\n\t\t\tlet res = await this._trigger( 'preRemove', id, http.data[keys[i]] );\n\n\t\t\t// Allow the event to be cancelled and inform the client-side\n\t\t\tif ( res === false ) {\n\t\t\t\tthis._out.cancelled.push( id );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tids.push( id );\n\t\t\t}\n\t\t}\n\n\t\tif ( ids.length === 0 ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Row based joins - remove first as the host row will be removed which\n\t\t// is a dependency\n\t\tfor ( let i = 0, ien = this._join.length; i < ien; i++ ) {\n\t\t\tawait this._join[i].remove( this, ids );\n\t\t}\n\n\t\t// Remove from the left join tables\n\t\tif ( this._leftJoinRemove ) {\n\t\t\tfor ( let i = 0, ien = this._leftJoin.length; i < ien; i++ ) {\n\t\t\t\tlet join = this._leftJoin[i];\n\t\t\t\tlet table = this._alias( join.table, 'orig' );\n\t\t\t\tlet parentLink;\n\t\t\t\tlet childLink;\n\n\t\t\t\t// Which side of the join refers to the parent table?\n\t\t\t\tif ( join.field1.indexOf( join.table ) === 0 ) {\n\t\t\t\t\tparentLink = join.field2;\n\t\t\t\t\tchildLink = join.field1;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tparentLink = join.field1;\n\t\t\t\t\tchildLink = join.field2;\n\t\t\t\t}\n\n\t\t\t\t// Only delete on the primary key, since that is what the ids refer\n\t\t\t\t// to - otherwise we'd be deleting random data! Note that this\n\t\t\t\t// won't work with compound keys since the parent link would be\n\t\t\t\t// over multiple fields.\n\t\t\t\tif ( parentLink === this._pkey[0] && this._pkey.length === 1 ) {\n\t\t\t\t\tawait this._removeTable( join.table, ids, [childLink] );\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Remove from the primary tables\n\t\tlet tables = this.table();\n\n\t\tfor ( let i = 0, ien = tables.length; i < ien; i++ ) {\n\t\t\tawait this._removeTable( tables[i], ids );\n\t\t}\n\n\t\tfor ( let i = 0, ien = ids.length; i < ien; i++ ) {\n\t\t\tawait this._trigger( 'postRemove', ids[i], http.data[ this.idPrefix() + ids[i] ] );\n\t\t}\n\t}\n\n\tprivate async _removeTable( table: string, ids: string[], pkey: string[] = null ): Promise<void> {\n\t\tif ( pkey === null ) {\n\t\t\tpkey = this.pkey();\n\t\t}\n\n\t\t// Check that there is actually a field which has a set option for this table\n\t\tlet count = 0;\n\t\tlet fields = this.fields();\n\t\tlet tableAlias = this._alias(table, 'alias');\n\n\t\tfor ( let i = 0, ien = fields.length; i < ien; i++ ) {\n\t\t\tlet dbField = fields[i].dbField();\n\n\t\t\tif ( dbField.indexOf('.') === -1 ||\n\t\t\t\t(this._part( dbField, 'table') === tableAlias && fields[i].set() !== SetType.None)\n\t\t\t) {\n\t\t\t\tcount++;\n\t\t\t}\n\t\t}\n\n\t\tif ( count > 0 ) {\n\t\t\tlet q = this.db().from( this._alias(table, 'orig') );\n\n\t\t\tfor ( let i = 0, ien = ids.length; i < ien; i++ ) {\n\t\t\t\tlet cond = this.pkeyToObject( ids[i], true, pkey );\n\n\t\t\t\tq.orWhere( function() {\n\t\t\t\t\tthis.where( cond );\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tawait q.del();\n\t\t}\n\t}\n\n\tprivate async _ssp( query: knex.QueryBuilder, http: IDtRequest ): Promise<ISSP> {\n\t\tif ( ! http || ! http.draw ) {\n\t\t\treturn {};\n\t\t}\n\n\t\t// Add the server-side processing conditions to the get query\n\t\tthis._sspLimit( query, http );\n\t\tthis._sspSort( query, http );\n\t\tthis._sspFilter( query, http );\n\n\t\t// Get the number of rows in the result set\n\t\tlet setCount = this\n\t\t\t.db()\n\t\t\t.from( this._readTable()[0] )\n\t\t\t.count( this._pkey[0] + ' as cnt' );\n\n\t\tthis._getWhere( setCount );\n\t\tthis._sspFilter( setCount, http );\n\t\tthis._performLeftJoin( setCount );\n\n\t\tlet res = await setCount;\n\t\tlet recordsFiltered = (res[0] as any).cnt;\n\n\t\t// Get the number of rows in the full set\n\t\tlet fullCount = this\n\t\t\t.db()\n\t\t\t.from( this._readTable()[0] )\n\t\t\t.count( this._pkey[0] + ' as cnt' );\n\n\t\tthis._getWhere( fullCount );\n\t\tif ( this._where.length  ) { // only needed if there is a where condition\n\t\t\tthis._performLeftJoin( fullCount );\n\t\t}\n\t\tres = await fullCount;\n\t\tlet recordsTotal = (res[0] as any).cnt;\n\n\t\treturn {\n\t\t\tdraw: http.draw * 1,\n\t\t\trecordsFiltered,\n\t\t\trecordsTotal\n\t\t};\n\t}\n\n\tprivate _sspField( http: IDtRequest, index: number ): string {\n\t\tlet name = http.columns[ index ].data;\n\t\tlet field = this._findField( name, 'name' );\n\n\t\tif ( ! field ) {\n\t\t\t// Is it the primary key?\n\t\t\tif ( name === 'DT_RowId' ) {\n\t\t\t\treturn this._pkey[0];\n\t\t\t}\n\n\t\t\tthrow new Error( 'Unknown field: ' + name + ' (index ' + index + ')' );\n\t\t}\n\n\t\treturn field.dbField();\n\t}\n\n\tprivate _sspFilter( query: knex.QueryBuilder, http: IDtRequest ): void {\n\t\tlet fields = this.fields();\n\n\t\t// Global filter\n\t\tif ( http.search.value ) {\n\t\t\tquery.where( (q) => {\n\t\t\t\tfor ( let i = 0, ien = http.columns.length; i < ien; i++ ) {\n\t\t\t\t\tif ( http.columns[i].searchable.toString() === 'true' ) {\n\t\t\t\t\t\tlet field = this._sspField( http, i );\n\n\t\t\t\t\t\tif ( field ) {\n\t\t\t\t\t\t\t// Nasty hack for Postgres\n\t\t\t\t\t\t\tif ( this._db.client.config.client === 'psql' ) {\n\t\t\t\t\t\t\t\tq.orWhere( field+'::text', 'ILIKE', '%' + http.search.value + '%' );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tq.orWhere( field, 'LIKE', '%' + http.search.value + '%' );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\t// Column filter\n\t\tfor ( let i = 0, ien = http.columns.length; i < ien; i++ ) {\n\t\t\tlet column = http.columns[i];\n\t\t\tlet search = column.search.value;\n\n\t\t\tif ( search !== '' && column.searchable.toString() === 'true' ) {\n\t\t\t\t// Nasty hack for Postgres\n\t\t\t\tif ( this._db.client.config.client === 'psql' ) {\n\t\t\t\t\tquery.where(\n\t\t\t\t\t\tthis._sspField( http, i )+'::text',\n\t\t\t\t\t\t'ILIKE',\n\t\t\t\t\t\t'%' + search + '%'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tquery.where(\n\t\t\t\t\t\tthis._sspField( http, i ),\n\t\t\t\t\t\t'LIKE',\n\t\t\t\t\t\t'%' + search + '%'\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _sspLimit( query: knex.QueryBuilder, http: IDtRequest ): void {\n\t\tif ( http.length !== -1 ) { // -1 is 'show all' in DataTables\n\t\t\tquery\n\t\t\t\t.limit( http.length * 1 )\n\t\t\t\t.offset( http.start * 1 );\n\t\t}\n\t}\n\n\tprivate _sspSort( query: knex.QueryBuilder, http: IDtRequest ): void {\n\t\tfor ( let i = 0, ien = http.order.length; i < ien; i++ ) {\n\t\t\tlet order = http.order[i];\n\n\t\t\tquery.orderBy(\n\t\t\t\tthis._sspField( http, order.column ),\n\t\t\t\torder.dir === 'asc' ? 'asc' : 'desc'\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate async _trigger( name: string, ...args ): Promise<boolean> {\n\t\tlet out = null;\n\t\tlet events = this._events[ name ];\n\n\t\tif ( ! this._events[ name ] ) {\n\t\t\treturn;\n\t\t}\n\n\t\targs.unshift( this );\n\n\t\tfor ( let i = 0, ien = events.length; i < ien; i++ ) {\n\t\t\tlet res = await events[i].apply( this, args );\n\n\t\t\tif ( res !== null ) {\n\t\t\t\tout = res;\n\t\t\t}\n\t\t}\n\n\t\treturn out;\n\t}\n\n\tprivate async _update( id: string, values: object ): Promise<object> {\n\t\tid = id.replace( this.idPrefix(), '' );\n\n\t\t// Update or insert the rows for the parent table and the left joined\n\t\t// tables\n\t\tawait this._insertOrUpdate( id, values );\n\n\t\t// Join\n\t\tfor ( let i = 0, ien = this._join.length; i < ien; i++ ) {\n\t\t\tawait this._join[i].update( this, id, values );\n\t\t}\n\n\t\t// Was the primary key altered as part of the edit, if so use the\n\t\t// submitted values\n\t\tlet getId = this._pkeySubmitMerge( id, values );\n\n\t\tawait this._trigger( 'writeEdit', id, values );\n\n\t\tlet row = await this._get( getId );\n\t\trow = row.data.length > 0 ?\n\t\t\trow.data[0] :\n\t\t\tnull;\n\n\t\tawait this._trigger( 'postEdit', id, values, row );\n\n\t\treturn row;\n\t}\n\n\tprivate async _upload( http: IDtRequest ): Promise<void> {\n\t\t// Search for the upload field in the local fields\n\t\tlet field = this._findField( http.uploadField, 'name' );\n\t\tlet fieldName = '';\n\n\t\tif ( ! field ) {\n\t\t\t// Perhaps it is in a join instance\n\t\t\tfor ( let i = 0, ien = this._join.length; i < ien; i++ ) {\n\t\t\t\tlet join = this._join[i];\n\t\t\t\tlet fields = join.fields();\n\n\t\t\t\tfor ( let j = 0, jen = fields.length; j < jen; j++ ) {\n\t\t\t\t\tlet joinField = fields[j];\n\t\t\t\t\tlet name = join.name() + '[].' + joinField.name();\n\n\t\t\t\t\tif ( name === http.uploadField ) {\n\t\t\t\t\t\tfield = joinField;\n\t\t\t\t\t\tfieldName = name;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tfieldName = field.name();\n\t\t}\n\n\t\tif ( ! this._uploadData ) {\n\t\t\tthrow new Error( 'No upload data supplied' );\n\t\t}\n\n\t\tif ( ! field ) {\n\t\t\tthrow new Error( 'Unknown upload field name submitted' );\n\t\t}\n\n\t\tlet eventRes = await this._trigger( 'preUpload', http );\n\n\t\t// Allow the upload to be cancelled by an event handler\n\t\tif ( eventRes === false ) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet upload = field.upload();\n\t\tif ( ! upload ) {\n\t\t\tthrow new Error( 'File uploaded to a field that does not have upload options configured' );\n\t\t}\n\n\t\tlet res = await upload.exec( this, this._uploadData );\n\n\t\tif ( ! res ) {\n\t\t\tthis._out.fieldErrors.push( {\n\t\t\t\tname: fieldName,\n\t\t\t\tstatus: upload.error()\n\t\t\t} );\n\t\t}\n\t\telse {\n\t\t\tlet files = await this._fileData( upload.table(), [res] );\n\n\t\t\tthis._out.files = files;\n\t\t\tthis._out.upload = {\n\t\t\t\tid: res\n\t\t\t};\n\t\t}\n\t}\n}\n"]}